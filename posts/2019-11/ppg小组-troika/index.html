<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>PPG小组 TROIKA - Walk Hanmei&#39;s World</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Hanmei"><meta name=description content="阅读论文《TROIKA: A General Framework for Heart Rate Monitoring Using Wrist-Type Photoplethysmographic Signals During Intensive Physical Exercise》"><meta name=keywords content="Life,Coding,Journal"><meta name=generator content="Hugo 0.59.0 with theme even"><link rel=canonical href=https://nicolemayer.github.io/posts/2019-11/ppg%E5%B0%8F%E7%BB%84-troika/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><link href=/dist/even.c2a46f00.min.css rel=stylesheet><meta property="og:title" content="PPG小组 TROIKA"><meta property="og:description" content="阅读论文《TROIKA: A General Framework for Heart Rate Monitoring Using Wrist-Type Photoplethysmographic Signals During Intensive Physical Exercise》"><meta property="og:type" content="article"><meta property="og:url" content="https://nicolemayer.github.io/posts/2019-11/ppg%E5%B0%8F%E7%BB%84-troika/"><meta property="article:published_time" content="2019-11-05T09:14:16-07:00"><meta property="article:modified_time" content="2019-11-05T09:14:16-07:00"><meta itemprop=name content="PPG小组 TROIKA"><meta itemprop=description content="阅读论文《TROIKA: A General Framework for Heart Rate Monitoring Using Wrist-Type Photoplethysmographic Signals During Intensive Physical Exercise》"><meta itemprop=datePublished content="2019-11-05T09:14:16-07:00"><meta itemprop=dateModified content="2019-11-05T09:14:16-07:00"><meta itemprop=wordCount content="2093"><meta itemprop=keywords content="运动伪影消除,论文阅读,"><meta name=twitter:card content="summary"><meta name=twitter:title content="PPG小组 TROIKA"><meta name=twitter:description content="阅读论文《TROIKA: A General Framework for Heart Rate Monitoring Using Wrist-Type Photoplethysmographic Signals During Intensive Physical Exercise》"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Hanmei@梅</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/about><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Hanmei@梅</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/about>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>PPG小组 TROIKA</h1><div class=post-meta><span class=post-time>2019-11-05</span><div class=post-category><a href=/categories/%E5%AD%A6%E6%9C%AF/>学术</a></div><span class=more-meta>2093 words</span>
<span class=more-meta>5 mins read</span>
<span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#troika>TROIKA</a></li><li><a href=#details>details</a><ul><li><a href=#1-signal-decomposition>(1) signal decomposition</a></li><li><a href=#2-temporal-difference-operation>(2) Temporal Difference Operation</a></li><li><a href=#3-sparse-signal-reconstruction>(3) Sparse Signal Reconstruction</a></li><li><a href=#4-spectral-peak-tracking>(4) Spectral Peak Tracking</a></li></ul></li><li><a href=#results>results</a></li><li><a href=#related-work>related work</a></li></ul></nav></div></div><div class=post-content><p><strong>阅读论文《TROIKA: A General Framework for Heart Rate Monitoring Using Wrist-Type Photoplethysmographic Signals During Intensive Physical Exercise》</strong></p><p>作者的 <a href=https://sites.google.com/site/researchbyzhang/>homepage</a> 2017年后的数据没再更新了，可能在学术界不活跃了？研究方向偏向于数据挖掘，信号处理之类，还涉及金融领域和医疗健康领域，是我比较喜欢的领域。</p><h1 id=前言>前言</h1><p>第一个碰到的名词就不太懂 <strong>Power Spectrum Estimation</strong> 翻译成中文就是<strong>功率谱估计</strong>，定义是<u>利用给定的一组样本数据估计一个平稳随机信号的功率谱密度</u>。</p><p>参考资料：<a href=https://blog.csdn.net/weixin_41999529/article/details/89642593>文章1</a> <a href=https://blog.csdn.net/u013457167/article/details/85805019>文章2</a></p><p>其中第二篇非常详细地介绍了各种不同的实现方法，文献中最先采用了传统傅里叶变换分析方法中的周期图法，然后提到了<a href="https://baike.baidu.com/item/music%E7%AE%97%E6%B3%95/1267135?fr=aladdin">music算法</a>但说它需要 model order selection 有点难，所以它提出了用 SSR-based spectrum estimation，该分析技术的前提是被估计的频谱是稀疏或压缩的，也就是说只有几个谱系数为非零值。</p><p>为了使得带有MA的PPG信号满足这个要求，我们需要对信号进行预处理。下图是两种不同方法的效果对比：</p><p><img src=https://i.loli.net/2019/11/07/OfirXbVmj8BLqHN.png alt></p><h1 id=troika>TROIKA</h1><p>该论文提出的信号处理框架，可以看到第一步使用了0.4～5Hz之间的带通滤波器（根据之前的文献资料，心跳的频率在0.5～4Hz内，呼吸的频率在0.2～0.35Hz内，MA噪声大概在大于0.1Hz的范围）</p><p><img src=https://i.loli.net/2019/11/07/eAc8wKJMOgINFyd.png alt></p><p><strong>TROIKA 三步走</strong></p><ol><li>signal decomposition 去除原始PPG信号中的MA，并且稀疏其频谱</li><li>sparse signal re-construction (ssr) 计算高分辨率PPG信号的频谱</li><li>spectral peak tracking 寻找心率对应的光谱峰（spectral peak）</li></ol><h1 id=details>details</h1><p>数据集：单通道PPG信号，三轴加速度信号和ECG信号</p><p>T秒的滑动窗口，以S的步长增加（S &lt;= T/2，T = 8， S = 2）</p><h2 id=1-signal-decomposition>(1) signal decomposition</h2><p>目的：降噪 / 稀疏化PPG信号的频谱</p><div>$$
\mathbf{y}=\sum_{i=1}^{Q} \mathbf{y}_{i}
$$</div><p>方法有：singular spectrum analysis (SSA) / single-channel independent component analysis 等等</p><p>他们选择了 SSA，包括四个步骤： Embedding, Singular Value Decomposition (SVD), Grouping, and Reconstruction.</p><p><img src=https://i.loli.net/2019/11/07/692Z3PwTRkInQrf.png alt></p><p><img src=https://i.loli.net/2019/11/07/ZLv7WlaEry6BDRG.png alt></p><p>clustering singular values [23, pp. 66] ⬇️</p><p><img src=https://i.loli.net/2019/11/07/qAUpwJEoynBNkeP.png alt></p><p><img src=https://i.loli.net/2019/11/07/zEfkhtdCDUNXOVQ.png alt></p><p>那怎样来辨别哪些部分是MA噪声呢？</p><p><u>首先使用 periodogram 来计算 dominant frequencies（幅度大于50%波谱中最大振幅的峰值）来确定加速度数据每个通道的频谱。F_acc 用来表示 set of location indexes of selected dominant frequencies in spectra.</p><p>其次按照上图所示的四个步骤走，grouping 之后 remove the time series whose dominant frequencies have location indexes in F_acc，剩余的信号用于重建PPG。</p><p>上述去除的过程可能会不小心去掉和心跳有关的信息，用 N_p 表示 the location indexes of fundamental and harmonic frequencies of the heartbeat estimated in the previous time window，在 F_acc 中排除掉 {Np − Δ,···,Np − 1,Np,Np + 1,&hellip;,Np + Δ}</u></p><p><span style=color:red>注：划线部分没搞清楚具体的操作</span></p><p>一些参数设置：L = 400， #FFT points = 4096，Δ = 10，sampling rate = 125 Hz</p><p>参考资料：<a href=https://github.com/aj-cloete/pySSA>Singular Spectrum Analysis for time series forecasting in Python</a></p><h2 id=2-temporal-difference-operation>(2) Temporal Difference Operation</h2><p>对得到的信号做二阶差分</p><p>为什么这么做呢？因为k阶差分能显著的表示基础频率和他的谐波频率。心率信号是周期的，MA信号是非周期的。</p><h2 id=3-sparse-signal-reconstruction>(3) Sparse Signal Reconstruction</h2><p>目的：生成 high-resolution spectrum estimation</p><p>SSR模型：</p><div>$$
y = Φ x + v
$$</div><p>y is an observed signal of the size M × 1</p><p>x is an unknown solution vector which is assumed to be sparse or compressive</p><p>v is an unknown noise vector</p><p>目标是基于 <code>y</code> 和 <code>Φ</code> 找到稀疏矩阵 <code>x</code>，可以根据以下公式：</p><div>$$
\widehat{\mathbf{x}} \leftarrow \min _{\mathbf{x}}\|\mathbf{y}-\mathbf{\Phi} \mathbf{x}\|_{2}^{2}+\lambda g(\mathbf{x})
$$</div><p>λ is a regularization parameter</p><p>g(x) is a penalty function encouraging the sparsity of the x</p><p>初始化 <code>Φ</code> 为：<div>$$
\Phi_{m, n}=e^{j \frac{2 \pi}{N} m n}, m=0, \ldots, M-1, n=0, \ldots, N-1
$$</div></p><p>当按照上述式子计算时，因为<code>Φ</code>非常大，所以计算量很大，一般在计算前会对<code>Φ</code>剪枝</p><p><img src=https://i.loli.net/2019/11/07/QBPxHK2XNLw4avA.png alt></p><p><img src=https://i.loli.net/2019/11/07/rS9OcJA34eg7kXw.png alt></p><p>当M远小于N时，Φ的列高度相关，这种情况下SSR算法效果不好。文章采用了<strong>FOCUSS算法</strong>，该算法在列向量高度相关时表现也很鲁棒</p><p><span style=color:red>这里不理解高度相关是怎么判断出来的？</span></p><h2 id=4-spectral-peak-tracking>(4) Spectral Peak Tracking</h2><p>目的：选择正确的谱峰 / 处理峰值受到MA干扰不存在的情况</p><p>(1) Initialization</p><p>要求实验对象在实验开始阶段尽量减少手部动作（大概2～3s），通过该阶段选择PPG频谱中最高频峰来估计心率</p><p>&emsp;</p><p>(2) Peak Selection</p><p>Nprev: frequency location index of HR estimated in the previous time window</p><p>R0 = [Nprev−Δs, &hellip;, Nprev+Δs]</p><p>R1 = [2(Nprev−Δs−1)+1, &hellip;, 2(Nprev+Δs−1)+1]</p><p>在这两个搜索范围里，选择3个higest peaks with amplitude no less than a threshold η</p><p>frequency location indexes of the three peaks in R0:<div>$$
N_{i}^{0}(i=1,2,3)
$$</div></p><p>indexes of the three peaks in R1:<div>$$
N_{j}^{1}(j=1,2,3)
$$</div></p><p>参数：Δs = 16，η = 30% of the highest peak amplitude in R</p><p><img src=https://i.loli.net/2019/11/07/UCWLkuIim2b7oGn.png alt></p><p>&emsp;</p><p>(3) Verification
目的：prevent the wrong tracking</p><p><strong>Rule1</strong>: prevent a large change in the estimated BPM values in two successive time windows</p><div>$$
N_{\mathrm{cur}}=\left\{\begin{array}{ll}{N_{\mathrm{prev}}+\tau,} & {\mathrm{if} \widehat{\mathrm{N}}-\mathrm{N}_{\mathrm{prev}} \geq \theta} \\ {N_{\mathrm{prev}}-\tau,} & {\mathrm{if} \widehat{\mathrm{N}}-\mathrm{N}_{\mathrm{prev}} \leq-\theta} \\ {\widehat{N},} & {\text { otherwise }}\end{array}\right.
$$</div><p>the whole spectrum [0, 125] (Hz) is divided into N = 4096 grids -&gt; a change of six locations in the spectrum means a change of about 11 BPM <span style=color:red>这怎么计算？</span></p><p>参数：θ = 6，τ = 2</p><p><strong>Rule2</strong>: prevent from losing tracking over long time</p><p>如果有很强烈的MA，每次用前一次的波谱来代替当前时刻的，导致信号丢失无法找回。所以如果 <code>N = Nprev</code> 出现了连续h个滑动窗口，那么就：</p><div>$$
N_{\mathrm{cur}}=N_{\mathrm{prev}}+2 \cdot N_{\mathrm{Trend}}
$$</div><div>$$
N_{\text {Trend }}=\left\{\begin{array}{ll}{1,} & {\text { if } \mathrm{BPM}_{\text {predict }}-\mathrm{BPM}_{\text {prev }} \geq 3} \\ {-1,} & {\text { if } \mathrm{BPM}_{\text {predict }}-\mathrm{BPM}_{\text {prev }} \leq-3(18)} \\ {0,} & {\text { otherwise }}\end{array}\right.
$$</div><p>参数：如果该现象发生，则Δs = 20；如果不发生，则Δs = 16，h = 3，The predicted BPM was obtained by using the <strong>third-order Polynomial curve fitting</strong> on the estimated BPM values in previous 20 time windows.</p><h1 id=results>results</h1><p>ground truth: 通过ECG信号（不经过任何处理）得到的60H/D (in BPM)</p><p>误差计算公式：
<img src=https://i.loli.net/2019/11/07/ksUP2DcSd7frigz.png alt></p><p>W is the total number of time windows</p><p>展示了 error1/2的数据 + <a href=https://en.wikipedia.org/wiki/Bland%E2%80%93Altman_plot>Bland–Altman plot</a></p><p>对照组：删除前述步骤中的任意一条，单个subject测得到的PPG和ECG信号对比，每一个步骤处理后信号的变化</p><h1 id=related-work>related work</h1><ol><li>independent component analysis (ICA) Kim and Yoo [3]</li><li>frequency-domain-based ICA Krishnan et al. [4] （ICA的缺点：multiple PPG sensors + 对数据独立性的假设）</li><li>adaptive noise cancelation (ANC) [6], [7] （第六篇看过，用了四种方法去除MA的信号动态选择其一作为 reference signal，缺陷就是后续的处理很容易受到参考信号的干扰 &amp; 当对象运动时重构信号很困难）</li><li>spectrum subtraction technique Fukushima et al. [8]</li><li>kalman filtering using acceleration data [9] （PPG的MA是有皮肤于脉搏血氧仪表面的间隙变化引起的，和加速度度量的手部运动有区别）</li><li>electronic processing methodology [10], time-frequency analysis [11], wavelet de- noising [12], and empirical mode decomposition (EMD)[13]</li></ol></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Hanmei</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2019-11-05</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/%E8%BF%90%E5%8A%A8%E4%BC%AA%E5%BD%B1%E6%B6%88%E9%99%A4/>运动伪影消除</a>
<a href=/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/>论文阅读</a></div><nav class=post-nav><a class=prev href=/posts/2019-11/20191106-%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/><i class="iconfont icon-left"></i><span class="prev-text nav-default">20191106 日常记录</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/posts/2019-11/20191105-%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/><span class="next-text nav-default">20191105 日常记录</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js crossorigin=anonymous></script><script type=text/javascript>var gitalk=new Gitalk({id:'2019-11-05 09:14:16 -0700 -0700',title:'PPG小组 TROIKA',clientID:'8d8830a8bdd2c3ba3869',clientSecret:'5dea07f5de4151736f94f1d8921972ac32a5f8dc',repo:'hanmeimei-blog',owner:'nicolemayer',admin:['nicolemayer'],body:decodeURI(location.href)});gitalk.render('gitalk-container');</script><noscript>Please enable JavaScript to view the <a href=https://github.com/gitalk/gitalk>comments powered by
gitalk.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=nicolemeimeibest@gmail.com class="iconfont icon-email" title=email></a><a href=https://github.com/NicoleMayer class="iconfont icon-github" title=github></a><a href=https://nicolemayer.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span></span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv>site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span></span></div><span class=copyright-year>&copy;
2019
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Hanmei</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script type=text/javascript src=/dist/even.26188efa.min.js></script><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$'],['\\(','\\)']]},showProcessingMessages:false,messageStyle:'none'};</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-151013261-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>